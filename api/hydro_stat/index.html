
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://zhuanglaihong.github.io/hydroutils/api/hydro_stat/">
      
      
        <link rel="prev" href="../hydroutils/">
      
      
        <link rel="next" href="../hydro_plot/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Statistical Analysis - hydroutils</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hydro_stat-statistical-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="hydroutils" class="md-header__button md-logo" aria-label="hydroutils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            hydroutils
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Statistical Analysis
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zhuanglaihong/hydroutils" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="hydroutils" class="md-nav__button md-logo" aria-label="hydroutils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    hydroutils
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zhuanglaihong/hydroutils" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydroutils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Core Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Statistical Analysis
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Statistical Analysis
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat" class="md-nav__link">
    <span class="md-ellipsis">
      hydro_stat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.KGE" class="md-nav__link">
    <span class="md-ellipsis">
      KGE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds" class="md-nav__link">
    <span class="md-ellipsis">
      cal_4_stat_inds
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_4_stat_inds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_stat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_gamma
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_stat_gamma">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_prcp_norm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_stat_prcp_norm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.ecdf" class="md-nav__link">
    <span class="md-ellipsis">
      ecdf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms" class="md-nav__link">
    <span class="md-ellipsis">
      fms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing" class="md-nav__link">
    <span class="md-ellipsis">
      mean_peak_timing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mean_peak_timing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df" class="md-nav__link">
    <span class="md-ellipsis">
      month_stat_for_daily_df
    </span>
  </a>
  
    <nav class="md-nav" aria-label="month_stat_for_daily_df">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data" class="md-nav__link">
    <span class="md-ellipsis">
      remove_abnormal_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_abnormal_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stat_error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error_i" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error_i
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors" class="md-nav__link">
    <span class="md-ellipsis">
      stat_errors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stat_errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm" class="md-nav__link">
    <span class="md-ellipsis">
      trans_norm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trans_norm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test_for_lst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Key Performance Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Performance Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nash-sutcliffe-efficiency-nse" class="md-nav__link">
    <span class="md-ellipsis">
      Nash-Sutcliffe Efficiency (NSE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kling-gupta-efficiency-kge" class="md-nav__link">
    <span class="md-ellipsis">
      Kling-Gupta Efficiency (KGE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-mean-square-error-rmse" class="md-nav__link">
    <span class="md-ellipsis">
      Root Mean Square Error (RMSE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bias" class="md-nav__link">
    <span class="md-ellipsis">
      Bias
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statistical-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Properties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Function Reference
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_arithmetric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mathematical Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS S3 Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging Utilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/zhuanglaihong/hydroutils/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat" class="md-nav__link">
    <span class="md-ellipsis">
      hydro_stat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.KGE" class="md-nav__link">
    <span class="md-ellipsis">
      KGE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds" class="md-nav__link">
    <span class="md-ellipsis">
      cal_4_stat_inds
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_4_stat_inds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_stat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_gamma
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_stat_gamma">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_prcp_norm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cal_stat_prcp_norm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.ecdf" class="md-nav__link">
    <span class="md-ellipsis">
      ecdf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms" class="md-nav__link">
    <span class="md-ellipsis">
      fms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing" class="md-nav__link">
    <span class="md-ellipsis">
      mean_peak_timing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mean_peak_timing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.mean_peak_timing--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df" class="md-nav__link">
    <span class="md-ellipsis">
      month_stat_for_daily_df
    </span>
  </a>
  
    <nav class="md-nav" aria-label="month_stat_for_daily_df">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data" class="md-nav__link">
    <span class="md-ellipsis">
      remove_abnormal_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_abnormal_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stat_error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error_i" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error_i
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors" class="md-nav__link">
    <span class="md-ellipsis">
      stat_errors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stat_errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm" class="md-nav__link">
    <span class="md-ellipsis">
      trans_norm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trans_norm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test_for_lst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Key Performance Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Performance Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nash-sutcliffe-efficiency-nse" class="md-nav__link">
    <span class="md-ellipsis">
      Nash-Sutcliffe Efficiency (NSE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kling-gupta-efficiency-kge" class="md-nav__link">
    <span class="md-ellipsis">
      Kling-Gupta Efficiency (KGE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-mean-square-error-rmse" class="md-nav__link">
    <span class="md-ellipsis">
      Root Mean Square Error (RMSE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bias" class="md-nav__link">
    <span class="md-ellipsis">
      Bias
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statistical-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Properties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Function Reference
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="hydro_stat-statistical-analysis">hydro_stat - Statistical Analysis<a class="headerlink" href="#hydro_stat-statistical-analysis" title="Permanent link">&para;</a></h1>
<p>The <code>hydro_stat</code> module provides comprehensive statistical analysis functions for hydrological data evaluation and model performance assessment.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>This module contains functions for:</p>
<ul>
<li><strong>Performance Metrics</strong>: Calculate standard hydrological model performance metrics</li>
<li><strong>Statistical Analysis</strong>: Compute various statistical properties of time series data  </li>
<li><strong>Flow Analysis</strong>: Analyze flow characteristics and patterns</li>
<li><strong>Data Transformations</strong>: Apply statistical transformations to improve data distributions</li>
</ul>
<h2 id="core-functions">Core Functions<a class="headerlink" href="#core-functions" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="hydroutils.hydro_stat"></a>
    <div class="doc doc-contents first">

        <p>Author: MHPI group, Wenyu Ouyang
Date: 2021-12-31 11:08:29
LastEditTime: 2025-01-06 19:47:33
LastEditors: Wenyu Ouyang
Description: statistics calculation
FilePath: /hydroutils/hydroutils/hydro_stat.py
Copyright (c) 2021-2022 MHPI group, Wenyu Ouyang. All rights reserved.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.KGE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">KGE</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">xo</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.KGE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Kling Gupta Efficiency (Gupta et al., 2009, http://dx.doi.org/10.1016/j.jhydrol.2009.08.003)
input:
    xs: simulated
    xo: observed
output:
    KGE: Kling Gupta Efficiency</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">KGE</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">xo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kling Gupta Efficiency (Gupta et al., 2009, http://dx.doi.org/10.1016/j.jhydrol.2009.08.003)</span>
<span class="sd">    input:</span>
<span class="sd">        xs: simulated</span>
<span class="sd">        xo: observed</span>
<span class="sd">    output:</span>
<span class="sd">        KGE: Kling Gupta Efficiency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">xs</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_4_stat_inds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_4_stat_inds" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate four statistics indices: percentile 10 and 90, mean value, standard deviation</p>
<h4 id="hydroutils.hydro_stat.cal_4_stat_inds--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.cal_4_stat_inds--parameters" title="Permanent link">&para;</a></h4>
<p>b
    input data</p>
<h4 id="hydroutils.hydro_stat.cal_4_stat_inds--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.cal_4_stat_inds--returns" title="Permanent link">&para;</a></h4>
<p>list
    [p10, p90, mean, std]</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate four statistics indices: percentile 10 and 90, mean value, standard deviation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b</span>
<span class="sd">        input data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        [p10, p90, mean, std]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">p90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">std</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">p10</span><span class="p">,</span> <span class="n">p90</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_stat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_stat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_stat" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get statistic values of x (Exclude the NaN values)</p>
<h4 id="hydroutils.hydro_stat.cal_stat--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.cal_stat--parameters" title="Permanent link">&para;</a></h4>
<p>x: the array</p>
<h4 id="hydroutils.hydro_stat.cal_stat--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.cal_stat--returns" title="Permanent link">&para;</a></h4>
<p>list
    [10% quantile, 90% quantile, mean, std]</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get statistic values of x (Exclude the NaN values)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x: the array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        [10% quantile, 90% quantile, mean, std]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># if b is [], then give it a 0 value</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_stat_gamma" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_stat_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_stat_gamma" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Try to transform a time series data to normal distribution</p>
<p>Now only for daily streamflow, precipitation and evapotranspiration;
When nan values exist, just ignore them.</p>
<h4 id="hydroutils.hydro_stat.cal_stat_gamma--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.cal_stat_gamma--parameters" title="Permanent link">&para;</a></h4>
<p>x
    time series data</p>
<h4 id="hydroutils.hydro_stat.cal_stat_gamma--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.cal_stat_gamma--returns" title="Permanent link">&para;</a></h4>
<p>list
    [p10, p90, mean, std]</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to transform a time series data to normal distribution</span>

<span class="sd">    Now only for daily streamflow, precipitation and evapotranspiration;</span>
<span class="sd">    When nan values exist, just ignore them.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x</span>
<span class="sd">        time series data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        [p10, p90, mean, std]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>  <span class="c1"># kick out Nan</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span>
    <span class="p">)</span>  <span class="c1"># do some tranformation to change gamma characteristics</span>
    <span class="k">return</span> <span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_stat_prcp_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_stat_prcp_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">meanprep</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_stat_prcp_norm" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>normalized variable by precipitation with cal_stat_gamma</p>
<p>dividing a var with prcp means we can get a normalized var without rainfall's magnitude's influence,
so that we don't have bias for dry and wet basins</p>
<h4 id="hydroutils.hydro_stat.cal_stat_prcp_norm--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.cal_stat_prcp_norm--parameters" title="Permanent link">&para;</a></h4>
<p>x
    data to be normalized
meanprep
    meanprep = readAttr(gageDict['id'], ['p_mean'])</p>
<h4 id="hydroutils.hydro_stat.cal_stat_prcp_norm--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.cal_stat_prcp_norm--returns" title="Permanent link">&para;</a></h4>
<p>list
    [p10, p90, mean, std]</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat_prcp_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">meanprep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    normalized variable by precipitation with cal_stat_gamma</span>

<span class="sd">    dividing a var with prcp means we can get a normalized var without rainfall&#39;s magnitude&#39;s influence,</span>
<span class="sd">    so that we don&#39;t have bias for dry and wet basins</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x</span>
<span class="sd">        data to be normalized</span>
<span class="sd">    meanprep</span>
<span class="sd">        meanprep = readAttr(gageDict[&#39;id&#39;], [&#39;p_mean&#39;])</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        [p10, p90, mean, std]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># meanprep = readAttr(gageDict[&#39;id&#39;], [&#39;q_mean&#39;])</span>
    <span class="n">tempprep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">meanprep</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># unit (mm/day)/(mm/day)</span>
    <span class="n">flowua</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">tempprep</span>
    <span class="k">return</span> <span class="n">cal_stat_gamma</span><span class="p">(</span><span class="n">flowua</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.ecdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.ecdf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute ECDF</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute ECDF&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.fms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fms</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.fms" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>TODO: not fully tested
Calculate the slope of the middle section of the flow duration curve [#]_</p>
<p>.. math::
    \%\text{BiasFMS} = \frac{\left | \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right | -
        \left | \log(Q_{o,\text{lower}}) - \log(Q_{o,\text{upper}}) \right |}{\left |
        \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right |} \times 100,</p>
<p>where :math:<code>Q_{s,\text{lower/upper}}</code> corresponds to the FDC of the simulations (here, <code>sim</code>) at the <code>lower</code> and
<code>upper</code> bound of the middle section and :math:<code>Q_{o,\text{lower/upper}}</code> similarly for the observations (here,
<code>obs</code>).</p>
<h4 id="hydroutils.hydro_stat.fms--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.fms--parameters" title="Permanent link">&para;</a></h4>
<p>obs : DataArray
    Observed time series.
sim : DataArray
    Simulated time series.
lower : float, optional
    Lower bound of the middle section in range ]0,1[, by default 0.2
upper : float, optional
    Upper bound of the middle section in range ]0,1[, by default 0.7</p>
<h4 id="hydroutils.hydro_stat.fms--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.fms--returns" title="Permanent link">&para;</a></h4>
<p>float
    Slope of the middle section of the flow duration curve.</p>
<h4 id="hydroutils.hydro_stat.fms--references">References<a class="headerlink" href="#hydroutils.hydro_stat.fms--references" title="Permanent link">&para;</a></h4>
<p>.. [#] Yilmaz, K. K., Gupta, H. V., and Wagener, T. ( 2008), A process-based diagnostic approach to model
    evaluation: Application to the NWS distributed hydrologic model, Water Resour. Res., 44, W09417,
    doi:10.1029/2007WR006716.</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fms</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: not fully tested</span>
<span class="sd">    Calculate the slope of the middle section of the flow duration curve [#]_</span>

<span class="sd">    .. math::</span>
<span class="sd">        \%\text{BiasFMS} = \frac{\left | \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right | -</span>
<span class="sd">            \left | \log(Q_{o,\text{lower}}) - \log(Q_{o,\text{upper}}) \right |}{\left |</span>
<span class="sd">            \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right |} \times 100,</span>

<span class="sd">    where :math:`Q_{s,\text{lower/upper}}` corresponds to the FDC of the simulations (here, `sim`) at the `lower` and</span>
<span class="sd">    `upper` bound of the middle section and :math:`Q_{o,\text{lower/upper}}` similarly for the observations (here,</span>
<span class="sd">    `obs`).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : DataArray</span>
<span class="sd">        Observed time series.</span>
<span class="sd">    sim : DataArray</span>
<span class="sd">        Simulated time series.</span>
<span class="sd">    lower : float, optional</span>
<span class="sd">        Lower bound of the middle section in range ]0,1[, by default 0.2</span>
<span class="sd">    upper : float, optional</span>
<span class="sd">        Upper bound of the middle section in range ]0,1[, by default 0.7</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Slope of the middle section of the flow duration curve.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [#] Yilmaz, K. K., Gupta, H. V., and Wagener, T. ( 2008), A process-based diagnostic approach to model</span>
<span class="sd">        evaluation: Application to the NWS distributed hydrologic model, Water Resour. Res., 44, W09417,</span>
<span class="sd">        doi:10.1029/2007WR006716.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">upper</span><span class="p">,</span> <span class="n">lower</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;upper and lower have to be in range ]0,1[&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lower</span> <span class="o">&gt;=</span> <span class="n">upper</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The lower threshold has to be smaller than the upper.&quot;</span><span class="p">)</span>

    <span class="c1"># get arrays of sorted (descending) discharges</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

    <span class="c1"># for numerical reasons change 0s to 1e-6. Simulations can still contain negatives, so also reset those.</span>
    <span class="n">sim</span><span class="p">[</span><span class="n">sim</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="n">obs</span><span class="p">[</span><span class="n">obs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>

    <span class="c1"># calculate fms part by part</span>
    <span class="n">qsm_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lower</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>
    <span class="n">qsm_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>
    <span class="n">qom_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lower</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>
    <span class="n">qom_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>

    <span class="n">fms</span> <span class="o">=</span> <span class="p">((</span><span class="n">qsm_lower</span> <span class="o">-</span> <span class="n">qsm_upper</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">qom_lower</span> <span class="o">-</span> <span class="n">qom_upper</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">qom_lower</span> <span class="o">-</span> <span class="n">qom_upper</span> <span class="o">+</span> <span class="mf">1e-6</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fms</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.mean_peak_timing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mean_peak_timing</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">datetime_coord</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.mean_peak_timing" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>TODO: not finished
Mean difference in peak flow timing.</p>
<p>Uses scipy.find_peaks to find peaks in the observed time series. Starting with all observed peaks, those with a
prominence of less than the standard deviation of the observed time series are discarded. Next, the lowest peaks
are subsequently discarded until all remaining peaks have a distance of at least 100 steps. Finally, the
corresponding peaks in the simulated time series are searched in a window of size <code>window</code> on either side of the
observed peaks and the absolute time differences between observed and simulated peaks is calculated.
The final metric is the mean absolute time difference across all peaks. For more details, see Appendix of [#]_</p>
<h4 id="hydroutils.hydro_stat.mean_peak_timing--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.mean_peak_timing--parameters" title="Permanent link">&para;</a></h4>
<p>obs : DataArray
    Observed time series.
sim : DataArray
    Simulated time series.
window : int, optional
    Size of window to consider on each side of the observed peak for finding the simulated peak. That is, the total
    window length to find the peak in the simulations is :math:<code>2 * \text{window} + 1</code> centered at the observed
    peak. The default depends on the temporal resolution, e.g. for a resolution of '1D', a window of 3 is used and
    for a resolution of '1H' the the window size is 12.
resolution : str, optional
    Temporal resolution of the time series in pandas format, e.g. '1D' for daily and '1H' for hourly.
datetime_coord : str, optional
    Name of datetime coordinate. Tried to infer automatically if not specified.</p>
<h4 id="hydroutils.hydro_stat.mean_peak_timing--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.mean_peak_timing--returns" title="Permanent link">&para;</a></h4>
<p>float
    Mean peak time difference.</p>
<h4 id="hydroutils.hydro_stat.mean_peak_timing--references">References<a class="headerlink" href="#hydroutils.hydro_stat.mean_peak_timing--references" title="Permanent link">&para;</a></h4>
<p>.. [#] Kratzert, F., Klotz, D., Hochreiter, S., and Nearing, G. S.: A note on leveraging synergy in multiple
    meteorological datasets with deep learning for rainfall-runoff modeling, Hydrol. Earth Syst. Sci.,
    https://doi.org/10.5194/hess-2020-221</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mean_peak_timing</span><span class="p">(</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1D&quot;</span><span class="p">,</span> <span class="n">datetime_coord</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: not finished</span>
<span class="sd">    Mean difference in peak flow timing.</span>

<span class="sd">    Uses scipy.find_peaks to find peaks in the observed time series. Starting with all observed peaks, those with a</span>
<span class="sd">    prominence of less than the standard deviation of the observed time series are discarded. Next, the lowest peaks</span>
<span class="sd">    are subsequently discarded until all remaining peaks have a distance of at least 100 steps. Finally, the</span>
<span class="sd">    corresponding peaks in the simulated time series are searched in a window of size `window` on either side of the</span>
<span class="sd">    observed peaks and the absolute time differences between observed and simulated peaks is calculated.</span>
<span class="sd">    The final metric is the mean absolute time difference across all peaks. For more details, see Appendix of [#]_</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : DataArray</span>
<span class="sd">        Observed time series.</span>
<span class="sd">    sim : DataArray</span>
<span class="sd">        Simulated time series.</span>
<span class="sd">    window : int, optional</span>
<span class="sd">        Size of window to consider on each side of the observed peak for finding the simulated peak. That is, the total</span>
<span class="sd">        window length to find the peak in the simulations is :math:`2 * \\text{window} + 1` centered at the observed</span>
<span class="sd">        peak. The default depends on the temporal resolution, e.g. for a resolution of &#39;1D&#39;, a window of 3 is used and</span>
<span class="sd">        for a resolution of &#39;1H&#39; the the window size is 12.</span>
<span class="sd">    resolution : str, optional</span>
<span class="sd">        Temporal resolution of the time series in pandas format, e.g. &#39;1D&#39; for daily and &#39;1H&#39; for hourly.</span>
<span class="sd">    datetime_coord : str, optional</span>
<span class="sd">        Name of datetime coordinate. Tried to infer automatically if not specified.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Mean peak time difference.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [#] Kratzert, F., Klotz, D., Hochreiter, S., and Nearing, G. S.: A note on leveraging synergy in multiple</span>
<span class="sd">        meteorological datasets with deep learning for rainfall-runoff modeling, Hydrol. Earth Syst. Sci.,</span>
<span class="sd">        https://doi.org/10.5194/hess-2020-221</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># verify inputs</span>
    <span class="n">_validate_inputs</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>

    <span class="c1"># get time series with only valid observations (scipy&#39;s find_peaks doesn&#39;t guarantee correctness with NaNs)</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">sim</span> <span class="o">=</span> <span class="n">_mask_valid</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>

    <span class="c1"># heuristic to get indices of peaks and their corresponding height.</span>
    <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
        <span class="n">obs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># infer name of datetime index</span>
    <span class="k">if</span> <span class="n">datetime_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">datetime_coord</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">infer_datetime_coord</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># infer a reasonable window size</span>
        <span class="n">window</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_frequency_factor</span><span class="p">(</span><span class="s2">&quot;12H&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)),</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># evaluate timing</span>
    <span class="n">timing_errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
        <span class="c1"># skip peaks at the start and end of the sequence and peaks around missing observations</span>
        <span class="c1"># (NaNs that were removed in obs &amp; sim would result in windows that span too much time).</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="n">window</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">window</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
                    <span class="n">obs</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">window</span><span class="p">][</span><span class="n">datetime_coord</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">obs</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">window</span><span class="p">][</span><span class="n">datetime_coord</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">freq</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">size</span>
                <span class="o">!=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">window</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># check if the value at idx is a peak (both neighbors must be smaller)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sim</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sim</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="n">peak_sim</span> <span class="o">=</span> <span class="n">sim</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># define peak around idx as the max value inside of the window</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">sim</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">window</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">window</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">peak_sim</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">values</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>

        <span class="c1"># get xarray object of qobs peak, for getting the date and calculating the datetime offset</span>
        <span class="n">peak_obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># calculate the time difference between the peaks</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">peak_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">datetime_coord</span><span class="p">]</span> <span class="o">-</span> <span class="n">peak_sim</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">datetime_coord</span><span class="p">]</span>

        <span class="n">timing_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">resolution</span><span class="p">))</span>

        <span class="n">timing_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timing_error</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timing_errors</span><span class="p">)</span> <span class="k">if</span> <span class="n">timing_errors</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.month_stat_for_daily_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">month_stat_for_daily_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.month_stat_for_daily_df" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>calculate monthly statistics for daily data</p>
<h4 id="hydroutils.hydro_stat.month_stat_for_daily_df--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.month_stat_for_daily_df--parameters" title="Permanent link">&para;</a></h4>
<p>df
    daily data</p>
<h4 id="hydroutils.hydro_stat.month_stat_for_daily_df--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.month_stat_for_daily_df--returns" title="Permanent link">&para;</a></h4>
<p>pd.DataFrame
    monthly statistics for daily data</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">month_stat_for_daily_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate monthly statistics for daily data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df</span>
<span class="sd">        daily data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        monthly statistics for daily data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># guarantee the index is datetime</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.remove_abnormal_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_abnormal_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="mf">0.99999</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.remove_abnormal_data" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>remove abnormal data</p>
<h4 id="hydroutils.hydro_stat.remove_abnormal_data--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.remove_abnormal_data--parameters" title="Permanent link">&para;</a></h4>
<p>data
    data to be removed
q
    lower quantile
q2
    upper quantile</p>
<h4 id="hydroutils.hydro_stat.remove_abnormal_data--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.remove_abnormal_data--returns" title="Permanent link">&para;</a></h4>
<p>np.array
    data after removing abnormal data</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_abnormal_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="mf">0.99999</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    remove abnormal data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">        data to be removed</span>
<span class="sd">    q</span>
<span class="sd">        lower quantile</span>
<span class="sd">    q2</span>
<span class="sd">        upper quantile</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        data after removing abnormal data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># remove abnormal data</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">q1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">q2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.stat_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stat_error</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">fill_nan</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.stat_error" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Statistics indicators include: Bias, RMSE, ubRMSE, Corr, R2, NSE, KGE, FHV, FLV</p>
<h4 id="hydroutils.hydro_stat.stat_error--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.stat_error--parameters" title="Permanent link">&para;</a></h4>
<p>target
    observations, 2-dim array [basin, sequence]
pred
    predictions, same dim with observations
fill_nan
    "no" means ignoring the NaN value, and it is the default setting;
    "sum" means calculate the sum of the following values in the NaN locations.
    For example, observations are [1, nan, nan, 2], and predictions are [0.3, 0.3, 0.3, 1.5].
    Then, "no" means [1, 2] v.s. [0.3, 1.5] while "sum" means [1, 2] v.s. [0.3 + 0.3 + 0.3, 1.5];
    "mean" represents calculate average value the following values in the NaN locations.</p>
<h4 id="hydroutils.hydro_stat.stat_error--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.stat_error--returns" title="Permanent link">&para;</a></h4>
<p>dict
    Bias, RMSE, ubRMSE, Corr, R2, NSE, KGE, FHV, FLV</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_error</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Statistics indicators include: Bias, RMSE, ubRMSE, Corr, R2, NSE, KGE, FHV, FLV</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target</span>
<span class="sd">        observations, 2-dim array [basin, sequence]</span>
<span class="sd">    pred</span>
<span class="sd">        predictions, same dim with observations</span>
<span class="sd">    fill_nan</span>
<span class="sd">        &quot;no&quot; means ignoring the NaN value, and it is the default setting;</span>
<span class="sd">        &quot;sum&quot; means calculate the sum of the following values in the NaN locations.</span>
<span class="sd">        For example, observations are [1, nan, nan, 2], and predictions are [0.3, 0.3, 0.3, 1.5].</span>
<span class="sd">        Then, &quot;no&quot; means [1, 2] v.s. [0.3, 1.5] while &quot;sum&quot; means [1, 2] v.s. [0.3 + 0.3 + 0.3, 1.5];</span>
<span class="sd">        &quot;mean&quot; represents calculate average value the following values in the NaN locations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Bias, RMSE, ubRMSE, Corr, R2, NSE, KGE, FHV, FLV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The input data should be 2-dim, not 3-dim. If you want to calculate metrics for 3-d arrays, please use stat_errors function.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fill_nan</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fill_nan should be a string.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The shape of target and pred should be the same.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill_nan</span> <span class="o">!=</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="n">each_non_nan_idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_non_nan_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">non_nan_idx_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
            <span class="n">each_non_nan_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">non_nan_idx_tmp</span><span class="p">)</span>
            <span class="c1"># TODO: now all_non_nan_idx is only set for ET, because of its irregular nan values</span>
            <span class="n">all_non_nan_idx</span> <span class="o">=</span> <span class="n">all_non_nan_idx</span> <span class="o">+</span> <span class="n">non_nan_idx_tmp</span>
            <span class="n">non_nan_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_non_nan_idx</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># some NaN data appear in different dates in different basins, so we have to calculate the metric for each basin</span>
        <span class="c1"># but for ET, it is not very resonable to calculate the metric for each basin in this way, for example,</span>
        <span class="c1"># the non_nan_idx: [1, 9, 17, 33, 41], then there are 16 elements in 17 -&gt; 33, so use all_non_nan_idx is better</span>
        <span class="c1"># hence we don&#39;t use each_non_nan_idx finally</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">Bias</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">RMSE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">ubRMSE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">Corr</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">R2</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">NSE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">KGE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">FHV</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">FLV</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">fill_nan</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># non_nan_idx = each_non_nan_idx[i]</span>
            <span class="n">targ_i</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">non_nan_idx</span><span class="p">]</span>
            <span class="n">pred_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduceat</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">non_nan_idx</span><span class="p">)</span>
            <span class="n">dict_i</span> <span class="o">=</span> <span class="n">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">)</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">out_dict</span>
    <span class="k">elif</span> <span class="n">fill_nan</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># non_nan_idx = each_non_nan_idx[i]</span>
            <span class="n">targ_i</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">non_nan_idx</span><span class="p">]</span>
            <span class="n">pred_i_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduceat</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">non_nan_idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">non_nan_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">idx4mean</span> <span class="o">=</span> <span class="n">non_nan_idx</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx4mean</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">non_nan_idx</span><span class="p">)</span>
            <span class="n">idx_interval</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx4mean</span><span class="p">,</span> <span class="n">idx4mean</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="n">pred_i</span> <span class="o">=</span> <span class="n">pred_i_sum</span> <span class="o">/</span> <span class="n">idx_interval</span>
            <span class="n">dict_i</span> <span class="o">=</span> <span class="n">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">)</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">out_dict</span>
    <span class="n">ngrid</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># Bias</span>
    <span class="n">Bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">pred</span> <span class="o">-</span> <span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># RMSE</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">pred</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># ubRMSE</span>
    <span class="n">predMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">targetMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">predAnom</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">predMean</span>
    <span class="n">targetAnom</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">targetMean</span>
    <span class="n">ubRMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">predAnom</span> <span class="o">-</span> <span class="n">targetAnom</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># rho R2 NSE</span>
    <span class="n">Corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">NSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">KGe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">PBiaslow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">PBiashigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">PBias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">num_lowtarget_zero</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngrid</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="c1"># percent bias</span>
            <span class="n">PBias</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xx</span> <span class="o">-</span> <span class="n">yy</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Theoretically at least two points for correlation</span>
                <span class="n">Corr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">yymean</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">SST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yy</span> <span class="o">-</span> <span class="n">yymean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">SSReg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="n">yymean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">SSRes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yy</span> <span class="o">-</span> <span class="n">xx</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">R2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSRes</span> <span class="o">/</span> <span class="n">SST</span>
                <span class="n">NSE</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSRes</span> <span class="o">/</span> <span class="n">SST</span>
                <span class="n">KGe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">KGE</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
            <span class="c1"># FHV the peak flows bias 2%</span>
            <span class="c1"># FLV the low flows bias bottom 30%, log space</span>
            <span class="n">pred_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
            <span class="n">target_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
            <span class="n">indexlow</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
            <span class="n">indexhigh</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
            <span class="n">lowpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
            <span class="n">highpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
            <span class="n">lowtarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
            <span class="n">hightarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowtarget</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_lowtarget_zero</span> <span class="o">=</span> <span class="n">num_lowtarget_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="c1"># Sometimes the lowtarget is all 0, which will cause a warning</span>
                <span class="c1"># but I know it is not an error, so I ignore it</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
                <span class="n">PBiaslow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowpred</span> <span class="o">-</span> <span class="n">lowtarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowtarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">PBiashigh</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">highpred</span> <span class="o">-</span> <span class="n">hightarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hightarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">outDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">Bias</span><span class="o">=</span><span class="n">Bias</span><span class="p">,</span>
        <span class="n">RMSE</span><span class="o">=</span><span class="n">RMSE</span><span class="p">,</span>
        <span class="n">ubRMSE</span><span class="o">=</span><span class="n">ubRMSE</span><span class="p">,</span>
        <span class="n">Corr</span><span class="o">=</span><span class="n">Corr</span><span class="p">,</span>
        <span class="n">R2</span><span class="o">=</span><span class="n">R2</span><span class="p">,</span>
        <span class="n">NSE</span><span class="o">=</span><span class="n">NSE</span><span class="p">,</span>
        <span class="n">KGE</span><span class="o">=</span><span class="n">KGe</span><span class="p">,</span>
        <span class="n">FHV</span><span class="o">=</span><span class="n">PBiashigh</span><span class="p">,</span>
        <span class="n">FLV</span><span class="o">=</span><span class="n">PBiaslow</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># &quot;The CDF of BFLV will not reach 1.0 because some basins have all zero flow observations for the &quot;</span>
    <span class="c1"># &quot;30% low flow interval, the percent bias can be infinite\n&quot;</span>
    <span class="c1"># &quot;The number of these cases is &quot; + str(num_lowtarget_zero)</span>
    <span class="k">return</span> <span class="n">outDict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.stat_error_i" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.stat_error_i" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>statistics for one dimensional array</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;statistics for one dimensional array&quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pred_i</span><span class="p">),</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">targ_i</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Theoretically at least two points for correlation</span>
    <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">pred_i</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">targ_i</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">me</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="c1"># RMSE</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="c1"># ubRMSE</span>
        <span class="n">pred_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">target_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="n">pred_anom</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">-</span> <span class="n">pred_mean</span>
        <span class="n">target_anom</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">target_mean</span>
        <span class="n">ubrmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">pred_anom</span> <span class="o">-</span> <span class="n">target_anom</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1"># rho R2 NSE</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">pearson_r</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">r_squared</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">nse</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">nse</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">kge</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">kge_2009</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="c1"># percent bias</span>
        <span class="n">pbias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xx</span> <span class="o">-</span> <span class="n">yy</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="c1"># FHV the peak flows bias 2%</span>
        <span class="c1"># FLV the low flows bias bottom 30%, log space</span>
        <span class="n">pred_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">target_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="n">indexlow</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
        <span class="n">indexhigh</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
        <span class="n">lowpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
        <span class="n">highpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
        <span class="n">lowtarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
        <span class="n">hightarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
        <span class="n">pbiaslow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowpred</span> <span class="o">-</span> <span class="n">lowtarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowtarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">pbiashigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">highpred</span> <span class="o">-</span> <span class="n">hightarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hightarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">Bias</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span>
            <span class="n">RMSE</span><span class="o">=</span><span class="n">rmse</span><span class="p">,</span>
            <span class="n">ubRMSE</span><span class="o">=</span><span class="n">ubrmse</span><span class="p">,</span>
            <span class="n">Corr</span><span class="o">=</span><span class="n">corr</span><span class="p">,</span>
            <span class="n">R2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
            <span class="n">NSE</span><span class="o">=</span><span class="n">nse</span><span class="p">,</span>
            <span class="n">KGE</span><span class="o">=</span><span class="n">kge</span><span class="p">,</span>
            <span class="n">FHV</span><span class="o">=</span><span class="n">pbiashigh</span><span class="p">,</span>
            <span class="n">FLV</span><span class="o">=</span><span class="n">pbiaslow</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The number of data is less than 2, we don&#39;t calculate the statistics.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.stat_errors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stat_errors</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">fill_nan</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.stat_errors" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate statistics for 3-dim arrays</p>
<h4 id="hydroutils.hydro_stat.stat_errors--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.stat_errors--parameters" title="Permanent link">&para;</a></h4>
<p>target : np.ndarray
    the observed data
pred : np.ndarray
    the predicted data
fill_nan : list, optional
    a list of strings, each string is "no", "sum" or "mean", by default None</p>
<h4 id="hydroutils.hydro_stat.stat_errors--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.stat_errors--returns" title="Permanent link">&para;</a></h4>
<p>list
    A list of dictionaries, each dictionary contains Bias, RMSE, ubRMSE, Corr, R2, NSE, KGE, FHV, FLV</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_errors</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate statistics for 3-dim arrays</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : np.ndarray</span>
<span class="sd">        the observed data</span>
<span class="sd">    pred : np.ndarray</span>
<span class="sd">        the predicted data</span>
<span class="sd">    fill_nan : list, optional</span>
<span class="sd">        a list of strings, each string is &quot;no&quot;, &quot;sum&quot; or &quot;mean&quot;, by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list of dictionaries, each dictionary contains Bias, RMSE, ubRMSE, Corr, R2, NSE, KGE, FHV, FLV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fill_nan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fill_nan</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The input data should be 3-dim, not 2-dim. If you want to calculate &quot;</span>
            <span class="s2">&quot;metrics for 2-d arrays, please use stat_error function.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The shape of target and pred should be the same.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fill_nan</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">fill_nan</span><span class="p">)</span> <span class="o">!=</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please give same length of fill_nan as the number of variables.&quot;</span>
        <span class="p">)</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">k_dict</span> <span class="o">=</span> <span class="n">stat_error</span><span class="p">(</span><span class="n">target</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">pred</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">fill_nan</span><span class="o">=</span><span class="n">fill_nan</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.trans_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trans_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var_lst</span><span class="p">,</span> <span class="n">stat_dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">to_norm</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.trans_norm" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>normalization, including denormalization code</p>
<h4 id="hydroutils.hydro_stat.trans_norm--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.trans_norm--parameters" title="Permanent link">&para;</a></h4>
<p>x
    2d or 3d data
    2d: 1st-sites, 2nd-var type
    3d: 1st-sites, 2nd-time, 3rd-var type
var_lst
    variables
stat_dict
    a dict with statistics info
to_norm
    if True, normalization; else denormalization</p>
<h4 id="hydroutils.hydro_stat.trans_norm--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.trans_norm--returns" title="Permanent link">&para;</a></h4>
<p>np.array
    normalized/denormalized data</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trans_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var_lst</span><span class="p">,</span> <span class="n">stat_dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">to_norm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    normalization, including denormalization code</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x</span>
<span class="sd">        2d or 3d data</span>
<span class="sd">        2d: 1st-sites, 2nd-var type</span>
<span class="sd">        3d: 1st-sites, 2nd-time, 3rd-var type</span>
<span class="sd">    var_lst</span>
<span class="sd">        variables</span>
<span class="sd">    stat_dict</span>
<span class="sd">        a dict with statistics info</span>
<span class="sd">    to_norm</span>
<span class="sd">        if True, normalization; else denormalization</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        normalized/denormalized data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">var_lst</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">var_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">var_lst</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_lst</span><span class="p">)):</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">var_lst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">stat_dict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">to_norm</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.wilcoxon_t_test" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wilcoxon_t_test</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">xo</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.wilcoxon_t_test" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Wilcoxon t test</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_t_test</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">xo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wilcoxon t test&quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">xs</span> <span class="o">-</span> <span class="n">xo</span>  <span class="c1"># same result when using xo-xs</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">wilcoxon</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wilcoxon_t_test_for_lst</span><span class="p">(</span><span class="n">x_lst</span><span class="p">,</span> <span class="n">rnd_num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Wilcoxon t test for every two array in a 2-d array</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils/hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_t_test_for_lst</span><span class="p">(</span><span class="n">x_lst</span><span class="p">,</span> <span class="n">rnd_num</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wilcoxon t test for every two array in a 2-d array&quot;&quot;&quot;</span>
    <span class="n">arr_lst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_lst</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">arr_lst_pair</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">arr_lst</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">arr_pair</span> <span class="ow">in</span> <span class="n">arr_lst_pair</span><span class="p">:</span>
        <span class="n">wi</span><span class="p">,</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">wilcoxon_t_test</span><span class="p">(</span><span class="n">arr_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wi</span><span class="p">,</span> <span class="n">rnd_num</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">rnd_num</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="key-performance-metrics">Key Performance Metrics<a class="headerlink" href="#key-performance-metrics" title="Permanent link">&para;</a></h2>
<h3 id="nash-sutcliffe-efficiency-nse">Nash-Sutcliffe Efficiency (NSE)<a class="headerlink" href="#nash-sutcliffe-efficiency-nse" title="Permanent link">&para;</a></h3>
<p>The NSE determines the relative magnitude of the residual variance compared to the measured data variance.</p>
<h3 id="kling-gupta-efficiency-kge">Kling-Gupta Efficiency (KGE)<a class="headerlink" href="#kling-gupta-efficiency-kge" title="Permanent link">&para;</a></h3>
<p>KGE provides a balanced measure that considers correlation, bias, and variability.</p>
<h3 id="root-mean-square-error-rmse">Root Mean Square Error (RMSE)<a class="headerlink" href="#root-mean-square-error-rmse" title="Permanent link">&para;</a></h3>
<p>RMSE measures the average magnitude of prediction errors.</p>
<h3 id="bias">Bias<a class="headerlink" href="#bias" title="Permanent link">&para;</a></h3>
<p>Bias measures the average tendency of the simulated values to be larger or smaller than observed values.</p>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="basic-statistics">Basic Statistics<a class="headerlink" href="#basic-statistics" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hydroutils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Sample data</span>
<span class="n">observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">12.3</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">15.2</span><span class="p">,</span> <span class="mf">11.8</span><span class="p">])</span>
<span class="n">simulated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.1</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">14.7</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">])</span>

<span class="c1"># Calculate comprehensive statistics</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">hu</span><span class="o">.</span><span class="n">stat_error</span><span class="p">(</span><span class="n">observed</span><span class="p">,</span> <span class="n">simulated</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NSE: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;NSE&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KGE: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;KGE&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="individual-metrics">Individual Metrics<a class="headerlink" href="#individual-metrics" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Calculate KGE separately</span>
<span class="n">kge_value</span> <span class="o">=</span> <span class="n">hu</span><span class="o">.</span><span class="n">KGE</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="n">observed</span><span class="p">)</span>

<span class="c1"># Flow duration curve analysis</span>
<span class="n">fms_value</span> <span class="o">=</span> <span class="n">hu</span><span class="o">.</span><span class="n">fms</span><span class="p">(</span><span class="n">observed</span><span class="p">,</span> <span class="n">simulated</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="statistical-properties">Statistical Properties<a class="headerlink" href="#statistical-properties" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Basic statistical indicators</span>
<span class="n">flow_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">basic_stats</span> <span class="o">=</span> <span class="n">hu</span><span class="o">.</span><span class="n">cal_stat</span><span class="p">(</span><span class="n">flow_data</span><span class="p">)</span>
<span class="n">four_stats</span> <span class="o">=</span> <span class="n">hu</span><span class="o">.</span><span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">flow_data</span><span class="p">)</span>

<span class="c1"># Empirical CDF</span>
<span class="n">sorted_data</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">hu</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">flow_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="function-reference">Function Reference<a class="headerlink" href="#function-reference" title="Permanent link">&para;</a></h2>
<p>The module includes the following main function categories:</p>
<ul>
<li><strong>Model Performance</strong>: <code>stat_error()</code>, <code>stat_errors()</code>, <code>KGE()</code></li>
<li><strong>Flow Analysis</strong>: <code>fms()</code>, <code>mean_peak_timing()</code></li>
<li><strong>Statistical Calculations</strong>: <code>cal_stat()</code>, <code>cal_stat_gamma()</code>, <code>cal_4_stat_inds()</code></li>
<li><strong>Distribution Analysis</strong>: <code>ecdf()</code>, <code>wilcoxon_t_test()</code></li>
</ul>
<p>For detailed function signatures and parameters, see the complete API documentation below.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2025-08-19
  </span>

    
    
    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>